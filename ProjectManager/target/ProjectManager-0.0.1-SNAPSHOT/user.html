<html>
<head>
	<link rel="stylesheet" type="text/css" href="User.css" media="screen" />
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<title>Adding an user</title>
</head>
<body ng-app="UserManagement" ng-controller="UserController">
<form>
	<div>
	<table border="0">
		<tr>
			<td>
 				<B>First Name:</B>
			</td>
			<td>
				<input type="text" name="firstname" size="30" ng-model="first_name"><br>			
			</td>
		</tr>
		<tr>
			<td>
 				<B>Last Name:</B>
			</td>
			<td>
				<input type="text" name="lastname"  size=30 ng-model="last_name"><br>			
			</td>
		</tr>
		<tr>
			<td>
 				<B>Employee ID:</B>
			</td>
			<td>
				<input type="text" name="employeeID"  size="10" ng-model="employee_id"><br>			
			</td>
		</tr>
		<tr>
			<td>
			</td>
			<td align="right">
				<input name="doAdd" type="submit" value="    Add    " ng-click="submitUser()">
  				<input name="doReset" type="reset" value="   Reset   " ng-click="resetUser()">						
			</td>
		</tr>
	</table>
</div>
</form>
<div>
	<hr color="darkblue" width="18%"></hr>
</div>
<form>
<div>
	<input type="text" name="lastname"  size="10" value="Search....">
	<font face="verdana" size="1"><I>  Sort:</I></font>
	<button type="button">First Name</button>
	<button type="button">Last Name</button>
	<button type="button">Id</button>
	</div>
<div>
	<hr style="border-top: dotted 1px;" width="18%"></hr>
</div>
</form>
<form>
<div  ng-repeat="user in users">
    <input type="text" name="resFirstName"  size=30 value=" {{ user.first_name }}">
    <input name="doEdit"type="submit" ng-click="doEdit()"  value="  Edit ">
    <br>
    <input type="text" name="resLastName"  size=30 value=" {{ user.last_name }}">
    <input name="doDelete" type="submit" ng-click="doDelete()"  value="Delete">
    <br>           
    <input type="text" name="resEmployeeId"  size=30 value=" {{ user.employee_id }}"> 
    <BR>
    <hr style="border-top: dotted 1px;" width="18%"></hr>
</div>
</form>
<script>
 var app = angular.module("UserManagement", []);
         
            //Controller Part
            app.controller("UserController", function($scope, $http) {
            	$scope.onloadFun = function() {
            		 _refreshUserData();
                  };
            	$scope.resetUser = function() {
            		_clearFormData();
                 };
            	$scope.doEdit = function() {
            		$scope.firstname=$scope.resFirstName;
            		$scope.lastname=$scope.resLastName;
            		$scope.employee_id=$scope.resEmployeeId;
            		$scope.doAdd="Update";
                 };
                 $scope.doDelete = function() {
                	 var method = "DELETE";
	                    var url = 'http://localhost:8090/ProjectManager/user/delete';
	                	   var data = {
	                		  first_name: $scope.resFirstName,
	                		 last_name: $scope.resLastName,
	                		employee_id:$scope.resEmployeeId,
	                		project_id: 0,
	                	    task_id: 0
	                   };
	                	 $http({
	                        method : method,
	                        url : url,
	                        data :  JSON.stringify(data),
	                        headers : {
	                            'Content-Type' : 'application/json'
	                        }
	                    }).then( _success, _error );
                  };
         				                $scope.submitUser = function() {
         				                	var method = "POST";
         				                    var url = 'http://localhost:8090/ProjectManager/user/add';
         				                	   var data = {
         				                		  first_name: $scope.first_name,
         				                		 last_name: $scope.last_name,
         				                		employee_id:$scope.employee_id,
         				                		project_id: 0,
         				                	    task_id: 0
         				                   };
         				                	 $http({
         				                        method : method,
         				                        url : url,
         				                        data :  JSON.stringify(data),
         				                        headers : {
         				                            'Content-Type' : 'application/json'
         				                        }
         				                    }).then( _success, _error );
         				                };
         				               function _refreshUserData() {
         				                    $http({
         				                        method : 'GET',
         				                        url : 'http://localhost:8090/ProjectManager/user/details'
         				                    }).then(function successCallback(response) {
         				                        $scope.users = response.data;
         				                    }, function errorCallback(response) {
         				                        console.log(response.statusText);
         				                    });
         				                }
         				               function _success(response) {
         				                    _refreshUserData();
         				                    _clearFormData()
         				                }
         				         
         				                function _error(response) {
         				                	 _refreshUserData();
         				                    console.log(response.statusText);
         				                }
         				         
         				                //Clear the form
         				                function _clearFormData() {
         				                    $scope.first_name="";
         				                    $scope.last_name = "";
         				                    $scope.employee_id = "";
         				                
         				                };
         
         				                });
</script>
</body>
</html>